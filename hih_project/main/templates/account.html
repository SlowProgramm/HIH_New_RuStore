{% extends 'base.html'%}
{% load static %}

{% block title %}
–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
{% endblock %}

{% block content %}
<div class="account_page-container">
    <div class="account_page-content">

        
        {% if user.is_authenticated %}

        <!-- HEADER -->
        <div class="acc-header">

            <div class="acc-user">
                <div class="acc-user-info">
                    {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" class="acc-avatar">
                    {% else %}
                        <div class="acc-avatar-placeholder">
                            {{ user.username|first|upper }}
                        </div>
                    {% endif %}

                    <div class="acc-user-details">
                        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h1>
                        <p>{{ user.email }}</p>
                    </div>
                </div>

                <div class="acc-actions">
                    <a href="{% url 'logout' %}" class="acc-btn acc-btn-secondary">–í—ã–π—Ç–∏</a>
                </div>
            </div>

            <!-- Stats -->
            <div class="acc-stats">
                <div class="acc-stat">
                    <div class="acc-stat-num">{{ user.bought_apps|length }}</div>
                    <div class="acc-stat-label">–ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                </div>
                <div class="acc-stat">
                    <div class="acc-stat-num">{{ user_estimations|length }}</div>
                    <div class="acc-stat-label">–û—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏</div>
                </div>
                <div class="acc-stat">
                    <div class="acc-stat-num">{{ user.achievements|length }}</div>
                    <div class="acc-stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                </div>
            </div>
        </div>

        <!-- SECTIONS -->
        <div class="acc-sections">

            <!-- Bought apps -->
            <div class="acc-section">
                <h2 class="acc-section-title">–ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>

                <div class="acc-grid">
                    {% if user.bought_apps %}
                        {% for app_id in user.bought_apps %}
                            <div class="acc-card">
                                <div class="acc-card-icon"></div>
                                <div class="acc-card-info">
                                    <div class="acc-card-name">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ #{{ forloop.counter }}</div>
                                    <div class="acc-card-meta">ID: {{ app_id }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="acc-empty">
                            <div class="acc-empty-icon">üì±</div>
                            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>
                            <a href="{% url 'apps' %}" class="acc-btn acc-btn-primary" style="margin-top: 15px;">
                                –ù–∞–π—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Achievements -->
            <div class="acc-section">
                <h2 class="acc-section-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>

                <div class="acc-grid">
                    {% if user.achievements %}
                        {% for achievement in user.achievements %}
                            <div class="acc-card">
                                <div class="acc-card-icon" style="background: #ffd700;"></div>
                                <div class="acc-card-info">
                                    <div class="acc-card-name">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ #{{ forloop.counter }}</div>
                                    <div class="acc-card-meta">ID: {{ achievement }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="acc-empty">
                            <div class="acc-empty-icon">üèÜ</div>
                            <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Reviews -->
            <div class="acc-section">
                <h2 class="acc-section-title">–í–∞—à–∏ –æ—Ü–µ–Ω–∫–∏</h2>

                <div class="acc-grid">
                    {% if user_estimations %}
                        {% for estimation in user_estimations %}
                            <a class="acc-card" href="{% url 'app_detail' app_id=estimation.app.id %}">
                                <img class="acc-card-icon" src="{{ estimation.app.icon.url }}">
                                <div class="acc-card-info">
                                    <div class="acc-card-name">–û—Ç–∑—ã–≤: "{{ estimation.app.name }}"</div>
                                    <div class="acc-card-meta">–†–µ–π—Ç–∏–Ω–≥: {{ estimation.estimation }}/5</div>
                                </div>
                            </a>
                        {% endfor %}
                    {% else %}
                        <div class="acc-empty">
                            <div class="acc-empty-icon">‚≠ê</div>
                            <p>–í—ã –µ—â—ë –Ω–µ –æ—Å—Ç–∞–≤–ª—è–ª–∏ –æ—Ü–µ–Ω–æ–∫</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        {% else %}

        <!-- Not authenticated -->
        <div class="acc-header">
            <div class="acc-empty">
                <div class="acc-empty-icon">üîí</div>
                <h2>–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã</h2>
                <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                <div class="acc-actions" style="justify-content: center;">
                    <a href="{% url 'login' %}" class="acc-btn acc-btn-primary">–í–æ–π—Ç–∏</a>
                    <a href="{% url 'signup' %}" class="acc-btn acc-btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                </div>
            </div>
        </div>

        {% endif %}
    </div>
</div>
{% endblock %}
